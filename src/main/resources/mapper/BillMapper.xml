<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wen.fist_springboot_smbms.mapper.BillMapper">
<!--    添加订单-->
    <insert id="addBill" parameterType="com.wen.fist_springboot_smbms.pojo.Bill">
        INSERT INTO smbms_bill (billCode, productName, productDesc, productUnit, productCount, totalPrice,
                                isPayment, createdBy, creationDate, modifyBy, modifyDate, providerId)
        VALUES (#{billCode}, #{productName}, #{productDesc}, #{productUnit}, #{productCount}, #{totalPrice},
                #{isPayment}, #{createdBy}, #{creationDate}, #{modifyBy}, #{modifyDate}, #{providerId})
    </insert>
<!--    修改订单信息-->
    <update id="modifyBill" parameterType="com.wen.fist_springboot_smbms.pojo.Bill">
        UPDATE smbms_bill
        SET billCode = #{billCode}, productName = #{productName}, productDesc = #{productDesc},
            productUnit = #{productUnit}, productCount = #{productCount}, totalPrice = #{totalPrice},
            isPayment = #{isPayment}, createdBy = #{createdBy}, creationDate = #{creationDate},
            modifyBy = #{modifyBy}, modifyDate = #{modifyDate}, providerId = #{providerId}
        WHERE id = #{id}
    </update>
<!--    根据ID删除订单-->
    <delete id="deleteBill">
        DELETE FROM smbms_bill WHERE id = #{id}
    </delete>
<!--    查询订单总数-->
    <select id="getBillCount" resultType="int">
        SELECT COUNT(*) FROM smbms_bill
        <where>
            <if test="productName != null and productName != ''">
                AND productName LIKE CONCAT('%',#{productName},'%')
            </if>

            <if test="providerId != 0">
                AND providerId = #{providerId}
            </if>

            <if test="isPayment != 0">
                AND isPayment = #{isPayment}
            </if>
        </where>
    </select>

<!--    获取订单列表-->
    <select id="getBillList" resultType="com.wen.fist_springboot_smbms.pojo.Bill">
        SELECT b.*, p.proName AS providerName
        FROM smbms_bill b
        LEFT JOIN smbms_provider p ON b.providerId = p.id
        <where>
            <if test="productName != null and productName != ''">
                AND b.productName LIKE CONCAT('%',#(productName),'%')
            </if>
            <if test="providerId != 0">
                AND b.providerId = #{productName}
            </if>
            <if test="isPayment != 0">
                AND b.isPayment = #{isPayment}
            </if>
        </where>
    </select>
<!--    根据订单 ID 查询订单-->
    <select id="findByBillId" resultType="com.wen.fist_springboot_smbms.pojo.Bill">
        SELECT b.*, p.proName AS providerName
        FROM smbms_bill b
        LEFT JOIN smbms_provider p ON b.providerId = p.id
        WHERE b.id = #{id}
    </select>
</mapper>
